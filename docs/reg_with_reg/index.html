<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>reg</title>
    <link rel="stylesheet" href="/node_modules/leaflet/dist/leaflet.css"/>
    <style>
        #map {
            bottom: 0;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
        }
    </style>
    <link rel="stylesheet" href="/node_modules/@fortawesome/fontawesome-free/css/all.css"/>
</head>
<body>
    <div id="map"></div>

    <script src="/node_modules/d3/dist/d3.min.js"></script>
    <script src="/node_modules/chroma-js/chroma.min.js"></script>
    <script src="/node_modules/proj4/dist/proj4.js"></script>
    <script src="/node_modules/leaflet/dist/leaflet.js"></script>
    <script src="/node_modules/georaster/dist/georaster.browser.bundle.min.js"></script>
    <script src="/node_modules/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
    <script src="/node_modules/geoblaze/dist/geoblaze.web.min.js"></script>
    
    <script src="SkyBrightness.js"></script>
    <script src="sky_brightness_breaks.js"></script>


    <script>
        // initalize leaflet map
        // var map = L.map('map').setView([42.4427334, -76.5158845], 6);
        var map = L.map('map');
        
        // add OpenStreetMap basemap
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        var url_to_geotiff_file = "https://cgettings.github.io/Light-Pollution-Map/sky_brightness.tif";
        
        fetch(url_to_geotiff_file)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {

            parseGeoraster(arrayBuffer).then(georaster => {
                console.log("georaster:", georaster);
                var layer = new GeoRasterLayer({
                    georaster: georaster,
                    resolution: 64,
                    opacity: 0.7,
                    mask: "./state_border.geojson",
                    mask_strategy: "outside"
                });
                layer.addTo(map);
                
                map.fitBounds(layer.getBounds());
                
                map.on('click', function(evt) {

                    var latlng = map.mouseEventToLatLng(evt.originalEvent);
                    
                    console.log("click", geoblaze.identify(georaster, [latlng.lng, latlng.lat]));

                });
                
                // map.on('mousemove', function(evt) {

                //     var latlng = map.mouseEventToLatLng(evt.originalEvent);

                //     console.log("mousemove", geoblaze.identify(georaster, [latlng.lng, latlng.lat]));

                // });
                
            });
        });
        
    </script>
</body>
</html>